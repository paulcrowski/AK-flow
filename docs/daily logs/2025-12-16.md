# Daily Log: ONE MIND Observability + UX Persistence (2025-12-16)

## ğŸ¯ cel sesji
DowieÅºÄ‡ P0 "ONE MIND" w praktyce: jedna oÅ› ticka (trace), jedna bramka mowy (commit), oraz obserwowalnoÅ›Ä‡ + UX, Å¼eby daÅ‚o siÄ™ diagnozowaÄ‡ i nie traciÄ‡ kontekstu po refreshu.

---

## âœ… Wykonane Zadania (co realnie zmieniliÅ›my)

### 1) Trace: korelacja tickÃ³w
- TraceId deterministyczny per tick.
- Trace scope w czasie ticka + auto-inject `traceId` do EventBus (feature-flagged).

### 2) Commit layer: jedna bramka mowy
- TickCommitter v1: dedupe przed mowÄ…, `blocked/blockReason`, liczniki, telemetry `TICK_COMMIT`.

### 3) Think mode: jawna faza myÅ›lenia
- Minimalny wybÃ³r trybu: `reactive | goal_driven | autonomous | idle` + telemetry `THINK_MODE_SELECTED`.

### 4) UX: pamiÄ™Ä‡ rozmowy per agent
- Snapshot rozmowy w localStorage (sanitize+clamp, fail-closed).
- Hydratacja rozmowy po refreshu i po przeÅ‚Ä…czeniu agenta.

### 5) UX fallback: Supabase (gdy localStorage puste)
- Feature-flagged fallback: jeÅ›li snapshot pusty â†’ dogranie ostatnich ~25 wiadomoÅ›ci z `ConversationArchive`.

### 6) Trace UI: debug overlay + eksport
- Trace HUD w UI pokazuje bieÅ¼Ä…cy tick (`traceId`, `tickNumber`, skipped, commit status, liczniki).
- Przycisk `COPY TRACE`: eksportuje eventy z `eventBus.getHistory()` przefiltrowane po `traceId` do schowka.

### 7) StabilnoÅ›Ä‡: szybkie sendy + spÃ³jny conversation state
- Fix: szybkie `Enter, Enter` nie gubi wejÅ›Ä‡ (kolejka FIFO w `useCognitiveKernelLite`).
- Fix: `conversationRef` utrzymywane w sync (eliminuje stale-closure w kontekÅ›cie ticka).

### 8) DreamConsolidation: epizody wrÃ³ciÅ‚y (nie zawsze 0)
- Fix: `EpisodicMemoryService.detectAndStore(...)` dziaÅ‚a takÅ¼e w Å›cieÅ¼ce `USE_MINIMAL_CORTEX_PROMPT`.

### 9) Autonomy: OFF dziaÅ‚a deterministycznie
- Fix: `TOGGLE_AUTONOMY` respektuje `payload.enabled` (zamiast flip), redukuje desync UI â†” runtime.

### 10) Trace HUD upgrade
- `FREEZE`: zatrzymuje HUD na wybranym `traceId`.
- `COPY FULL`: eksport peÅ‚nego trace bez `.slice(-300)`.
- `COPY +2S`: eksport trace z oknem czasowym Â±2s (korelacja z eventami `ext-*`).

### 11) NeuroMonitor: filtry dziaÅ‚ajÄ…
- Fix: ALL/DREAMS/CHEM/SPEECH/ERRORS/FLOW/CONFESS faktycznie filtrujÄ… logi (spÃ³jnie dla zakÅ‚adek).

### Commity
- `c05cfb0` fix: dreamconsolidation, input queue, trace correlation
- `9a9793d` fix: trace hud freeze/copy full, log filters, deterministic autonomy toggle

---

## ğŸ§ª Weryfikacja (ALARM-3)
- `npm run build` â³ PENDING (do odpalenia po ostatnich commitach)
- `npm test` âœ… PASS (504/504)
- Wiring:
  - `npm test -- --run IntegrationWiring` âœ… PASS
  - `npm test -- --run WiringValidator` âœ… PASS

---

## â¡ï¸ Co dalej (jutro)
1) Trace coverage poza tickiem: scope dla async/UI/background (Å¼eby wszystko miaÅ‚o `traceId`).
2) UstaliÄ‡ i domknÄ…Ä‡ rollout flag: ktÃ³re zostajÄ… OFF domyÅ›lnie, ktÃ³re moÅ¼emy wÅ‚Ä…czaÄ‡ w dev.
3) (JeÅ›li wracamy do â€coreâ€) zaczÄ…Ä‡ AgentTrajectory (execution-first autonomy) wg NEXUS.
