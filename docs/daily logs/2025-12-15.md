# Daily Log: Hybrid + Soft Homeostasis (2025-12-15)

## ðŸŽ¯ cel Sesji
Implementacja "Soft Homeostasis" (Social Dynamics) jako rozwiÄ…zania dla problemu "SpamujÄ…cego Agenta" (Split Brain), ktÃ³ry w trybie autonomicznym nie reagowaÅ‚ na brak odpowiedzi uÅ¼ytkownika.

---

## âœ… Wykonane Zadania

### 1. Architektura (Social Dynamics)
- Stworzono interfejs `SocialDynamics` (`socialCost`, `autonomyBudget`, `userPresenceScore`).
- Zdefiniowano event `SOCIAL_DYNAMICS_UPDATE` jako uniwersalny noÅ›nik zmian stanu.

### 2. Kernel Logic (Reducer)
- Zaimplementowano logikÄ™ w `reducer.ts`:
  - **Eskalacja:** Agent mÃ³wi â†’ `socialCost` roÅ›nie, `autonomyBudget` spada.
  - **Ulga:** User odpowiada â†’ `socialCost` / 2, `autonomyBudget` refill.
  - **Decay:** Czas pÅ‚ynie â†’ `socialCost` powoli spada, `userPresenceScore` maleje (zapominanie).

### 3. Event Loop Integration
- Zaktualizowano `EventLoop.ts` o funkcjÄ™ `shouldSpeakToUser`:
  - Sprawdza `autonomyBudget` (hard block < 0.2).
  - Oblicza `effectivePressure` vs `dynamicThreshold` (zaleÅ¼ny od obecnoÅ›ci usera).
  - Dodano `StyleGuard` jako filtr ostateczny przed emisjÄ….

### 4. Hooki (React Integration)
- Zaktualizowano `useCognitiveKernelLite.ts`:
  - `handleInput` â†’ wyzwala `userResponded: true` (ulga).
  - `tick` â†’ wyzwala `silenceMs` (decay).
  - `agentSpoke` â†’ wyzwala eskalacjÄ™ kosztu.

---

## ðŸ§ª Weryfikacja
- Przeprowadzono audyt plikÃ³w: `types.ts`, `initialState.ts`, `reducer.ts`, `EventLoop.ts`.
- Wykryto i naprawiono brakujÄ…ce ogniwo w `useCognitiveKernelLite` (brak flagi `userResponded`).
- Zweryfikowano logikÄ™ `StyleGuard` i integracjÄ™ z `AgentIdentity` (`style_prefs`).

---

## ðŸ“ Notatki Architektoniczne
- "Rigid Cooldowns" (max 1 msg/min) zostaÅ‚y zastÄ…pione przez "BiologicznÄ… RegulacjÄ™".
- Agenta nie blokuje "zegar", tylko "zmÄ™czenie spoÅ‚eczne" (social cost).
- To rozwiÄ…zuje problem manii/spamu w sposÃ³b naturalny dla AGI.

---

## ðŸ§ª Testy / Weryfikacja (Basic)

- `npm run build` âœ… PASS
- `npm test` âœ… PASS (408/408)
- Test dedykowany SocialDynamics (13 testÃ³w):

```bash
npm test -- --run __tests__/integration/SocialDynamics.test.ts
```

### Refactor v1.1 (wieczÃ³r 15/12):
- **UsuniÄ™to `silenceMs`** z `SocialDynamicsPayload` i store API
- **Decay SocialDynamics** teraz liczony w `reducer.handleTick()` z `KernelState.lastUserInteractionAt`
- **Baseline `socialCost = 0.05`** (nigdy nie spada do zera)
- **`USER_INPUT` reducer** automatycznie aplikuje `userResponded` relief (hooki nie muszÄ… dispatchowaÄ‡)
- **EventLoop** respektuje `SYSTEM_CONFIG.socialDynamics` i `SYSTEM_CONFIG.styleGuard.enabled`

---

## âš™ï¸ Konfiguracja (co jest gdzie)

- Soft homeostasis:
  - `core/config/systemConfig.ts` â†’ `SYSTEM_CONFIG.socialDynamics`
- Style filtering (opcjonalne):
  - `core/config/systemConfig.ts` â†’ `SYSTEM_CONFIG.styleGuard`
  - Stan na dziÅ›: **StyleGuard domyÅ›lnie OFF** (Å¼eby testowaÄ‡ ewolucjÄ™ osobowoÅ›ci bez "kontraktu" UI).

---

## âž¡ï¸ Plan na kolejny dzieÅ„ (propozycja)

1. Unified Input Queue (Single Source of Truth dla czasu i inputu) â€“ zamknÄ…Ä‡ Double Brain.
2. DokoÅ„czyÄ‡ serotonin reactions w `ChemistryBridge` (stabilnoÅ›Ä‡ emocji po poraÅ¼kach).
3. DorobiÄ‡ minimalne narzÄ™dzia NOTES/READ_FILE (realne sygnaÅ‚y do EvaluationBus).

---

## âœ… Procedura zamkniÄ™cia dnia (Day Close) + zamkniÄ™cie jednego commita

Minimalny check (10-15 min):

1. **Testy**
   - `npm run build`
   - `npm test`
2. **Dokumentacja**
   - dopisz do tego pliku: co zrobione, jak zweryfikowane, co dalej
   - jeÅ›li byÅ‚ nowy problem/przeÅ‚om: dopisz do `docs/engineering/CHALLENGES.md`
   - jeÅ›li zmieniÅ‚ siÄ™ flow/architektura: uaktualnij `docs/SYSTEM_MANIFEST.md` i `docs/architecture/ARCHITECTURE_MAP.md`
3. **Nexus (ak-flow-state.json)**
   - zaktualizuj `lastModified`
   - dopisz krÃ³tkie podsumowanie dnia do `notes`
   - zaktualizuj `stats.testsTotal/testsPassing`
   - ustaw plan na jutro (tasks: TODAY/TOMORROW)
4. **Commit close**
   - jeden commit = jedna spÃ³jna zmiana + testy + wpis w daily log
   - w treÅ›ci commita: `feat(faza6): soft homeostasis + tests` (albo podobnie)
