# 2025-12-25

## P0.0 Pre-flight

- npm test: PASS (623 tests, 1 skipped)
  - notes: RLS/auth warnings during ShadowLoop + semanticSearch; no test failures
- npm run build: PASS (vite build)
  - warnings: dynamic import chunking notes for systemConfig/HardFacts/Prism/FactEcho; chunk size > 500kB

## Steps 1-4

- Step 1: ReactiveStep CREATE parser handles `tresc:` pattern; unit test added (IntentContract).
- Step 2: Autonomy CLARIFY triggers on missing-data punctuation; unit test added (AutonomyRepertoire).
- Step 3: FactEcho + PersonaGuard both run in CortexTextService legacy flow; tests: FactEchoPipeline + PersonaGuard.
- Step 4: EMBEDDINGS_STATUS telemetry emitted, cooldown banner added in UI, memory recall counts event emitted; tests: EmbeddingStatus + MemoryServiceEmbeddingFallback.

## Evidence (grep)

- FactEcho callsites:
  - src/llm/gemini/CortexTextService.ts:233 guardLegacyWithFactEcho
  - src/core/systems/cortex/processUserMessage.ts:128 guardCortexOutputWithFactEcho
- checkFactMutations callsites:
  - src/core/systems/PersonaGuard.ts:169 (definition only)

## EMBEDDINGS_STATUS log

```
[EMBEDDINGS_STATUS] {
  event: 'EMBEDDINGS_STATUS',
  enabled: true,
  cooldownActive: true,
  cooldownUntil: 1766681253746,
  lastErrorCode: 'SAFETY_BLOCK',
  successCount: 0,
  failCount: 1
}
```

## Manual UI pending

- Step 1: "stworz plik paul.txt tresc: test" + "stworz plik raport.md tresc: 123".
- Step 2: missing-context question -> CLARIFY question.
- Step 4: embeddings 500 -> "Embeddings offline - cooldown Xs" banner visible.
- Step 5: memory yesterday/week queries + SessionMemory recall logs.

## Summary

- Dodane testy jednostkowe dla MemoryUnited v1 (intent detection, kolejnosc retrieval, content hash, Thalamus, MemorySpace cache key).
- ThalamusFilter: krotkie sygnaly (np. ok/xd) zapisuja sie z niska salience i bez embeddingu.
- Potwierdzona kolejnosc kontekstu: session chunks -> identity shards -> raw memories w UnifiedContextBuilder.

## Verification

- `npx vitest run __tests__/unit/IntentDetector.test.ts __tests__/unit/ThalamusFilter.test.ts __tests__/unit/contentHash.test.ts __tests__/unit/MemoryRecallOrdering.test.ts __tests__/unit/MemorySpace.test.ts __tests__/unit/UnifiedContextBuilder.test.ts`: PASS (32 tests).
- npm test: not rerun after latest changes (last known PASS earlier in session).
- npm run build: not rerun after latest changes.

## Next

- Rerun full `npm test` + `npm run build` after latest changes.
- Manual UI checks: file create via `tresc:`, CLARIFY on missing context, embeddings cooldown banner, memory recall (yesterday/week).
